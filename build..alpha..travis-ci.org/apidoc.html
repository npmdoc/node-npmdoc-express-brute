<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/AdamPflug/express-brute#readme"

    >express-brute (v1.0.1)</a>
</h1>
<h4>A brute-force protection middleware for express routes that rate limits incoming requests</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute">module express-brute</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.express-brute">
            function <span class="apidocSignatureSpan"></span>express-brute
            <span class="apidocSignatureSpan">(store, options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.AbstractClientStore">
            function <span class="apidocSignatureSpan">express-brute.</span>AbstractClientStore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.FailForbidden">
            function <span class="apidocSignatureSpan">express-brute.</span>FailForbidden
            <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.FailMark">
            function <span class="apidocSignatureSpan">express-brute.</span>FailMark
            <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.FailTooManyRequests">
            function <span class="apidocSignatureSpan">express-brute.</span>FailTooManyRequests
            <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore">
            function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.get">
            function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore.prototype.get
            <span class="apidocSignatureSpan">(key, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.reset">
            function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore.prototype.reset
            <span class="apidocSignatureSpan">(key, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.set">
            function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore.prototype.set
            <span class="apidocSignatureSpan">(key, value, lifetime, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute._getKey">
            function <span class="apidocSignatureSpan">express-brute.</span>_getKey
            <span class="apidocSignatureSpan">(arr)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.defaults.handleStoreError">
            function <span class="apidocSignatureSpan">express-brute.</span>defaults.handleStoreError
            <span class="apidocSignatureSpan">(err)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.toString">
            function <span class="apidocSignatureSpan">express-brute.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">express-brute.</span>instanceCount</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">express-brute.</span>AbstractClientStore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">express-brute.</span>MemoryStore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">express-brute.</span>defaults</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.AbstractClientStore">module express-brute.AbstractClientStore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.AbstractClientStore.AbstractClientStore">
            function <span class="apidocSignatureSpan">express-brute.</span>AbstractClientStore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.AbstractClientStore.prototype">module express-brute.AbstractClientStore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.AbstractClientStore.prototype.increment">
            function <span class="apidocSignatureSpan">express-brute.AbstractClientStore.prototype.</span>increment
            <span class="apidocSignatureSpan">(key, lifetime, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.FailForbidden">module express-brute.FailForbidden</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.FailForbidden.FailForbidden">
            function <span class="apidocSignatureSpan">express-brute.</span>FailForbidden
            <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.FailMark">module express-brute.FailMark</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.FailMark.FailMark">
            function <span class="apidocSignatureSpan">express-brute.</span>FailMark
            <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.FailTooManyRequests">module express-brute.FailTooManyRequests</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.FailTooManyRequests.FailTooManyRequests">
            function <span class="apidocSignatureSpan">express-brute.</span>FailTooManyRequests
            <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.MemoryStore">module express-brute.MemoryStore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.MemoryStore">
            function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">express-brute.MemoryStore.</span>defaults</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.MemoryStore.prototype">module express-brute.MemoryStore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.get">
            function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>get
            <span class="apidocSignatureSpan">(key, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.reset">
            function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>reset
            <span class="apidocSignatureSpan">(key, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.set">
            function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>set
            <span class="apidocSignatureSpan">(key, value, lifetime, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.MemoryStore.prototype.get">module express-brute.MemoryStore.prototype.get</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.get.get">
            function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>get
            <span class="apidocSignatureSpan">(key, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.MemoryStore.prototype.reset">module express-brute.MemoryStore.prototype.reset</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.reset.reset">
            function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>reset
            <span class="apidocSignatureSpan">(key, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.MemoryStore.prototype.set">module express-brute.MemoryStore.prototype.set</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.MemoryStore.prototype.set.set">
            function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>set
            <span class="apidocSignatureSpan">(key, value, lifetime, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute._getKey">module express-brute._getKey</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute._getKey._getKey">
            function <span class="apidocSignatureSpan">express-brute.</span>_getKey
            <span class="apidocSignatureSpan">(arr)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.defaults">module express-brute.defaults</a><ol>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">express-brute.defaults.</span>attachResetToRequest</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">express-brute.defaults.</span>refreshTimeoutOnRequest</span>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.defaults.failCallback">
            function <span class="apidocSignatureSpan">express-brute.defaults.</span>failCallback
            <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.defaults.handleStoreError">
            function <span class="apidocSignatureSpan">express-brute.defaults.</span>handleStoreError
            <span class="apidocSignatureSpan">(err)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">express-brute.defaults.</span>freeRetries</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">express-brute.defaults.</span>maxWait</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">express-brute.defaults.</span>minWait</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">express-brute.defaults.</span>proxyDepth</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.defaults.handleStoreError">module express-brute.defaults.handleStoreError</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.defaults.handleStoreError.handleStoreError">
            function <span class="apidocSignatureSpan">express-brute.defaults.</span>handleStoreError
            <span class="apidocSignatureSpan">(err)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.express-brute.toString">module express-brute.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.express-brute.toString.toString">
            function <span class="apidocSignatureSpan">express-brute.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute" id="apidoc.module.express-brute">module express-brute</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.express-brute" id="apidoc.element.express-brute.express-brute">
        function <span class="apidocSignatureSpan"></span>express-brute
        <span class="apidocSignatureSpan">(store, options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">express-brute = function (store, options) {
	var i;
	ExpressBrute.instanceCount++;
	this.name = &#x22;brute&#x22;+ExpressBrute.instanceCount;
	_.bindAll(this, &#x27;reset&#x27;, &#x27;getMiddleware&#x27;);

	// set options
	this.options = _.extend({}, ExpressBrute.defaults, options);
	if (this.options.minWait &#x3c; 1) {
		this.options.minWait = 1;
	}
	this.store = store;

	// build delays array
	this.delays = [this.options.minWait];
	while(this.delays[this.delays.length-1] &#x3c; this.options.maxWait) {
		var nextNum = this.delays[this.delays.length-1] + (this.delays.length &#x3e; 1 ? this.delays[this.delays.length-2] : 0);
		this.delays.push(nextNum);
	}
	this.delays[this.delays.length-1] = this.options.maxWait;

	// set default lifetime
	if (typeof this.options.lifetime == &#x22;undefined&#x22;) {
		this.options.lifetime = (this.options.maxWait/1000)*(this.delays.length + this.options.freeRetries);
		this.options.lifetime = Math.ceil(this.options.lifetime);
	}

	// generate &#x22;prevent&#x22; middleware
	this.prevent = this.getMiddleware();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.AbstractClientStore" id="apidoc.element.express-brute.AbstractClientStore">
        function <span class="apidocSignatureSpan">express-brute.</span>AbstractClientStore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">AbstractClientStore = function () {
	
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.FailForbidden" id="apidoc.element.express-brute.FailForbidden">
        function <span class="apidocSignatureSpan">express-brute.</span>FailForbidden
        <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">FailForbidden = function (req, res, next, nextValidRequestDate) {
	setRetryAfter(res, nextValidRequestDate);
	res.status(403);
	res.send({error: {text: &#x22;Too many requests in this time frame.&#x22;, nextValidRequestDate: nextValidRequestDate}});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.FailMark" id="apidoc.element.express-brute.FailMark">
        function <span class="apidocSignatureSpan">express-brute.</span>FailMark
        <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">FailMark = function (req, res, next, nextValidRequestDate) {
	res.status(429);
	setRetryAfter(res, nextValidRequestDate);
	res.nextValidRequestDate = nextValidRequestDate;
	next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.FailTooManyRequests" id="apidoc.element.express-brute.FailTooManyRequests">
        function <span class="apidocSignatureSpan">express-brute.</span>FailTooManyRequests
        <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">FailTooManyRequests = function (req, res, next, nextValidRequestDate) {
	setRetryAfter(res, nextValidRequestDate);
	res.status(429);
	res.send({error: {text: &#x22;Too many requests in this time frame.&#x22;, nextValidRequestDate: nextValidRequestDate}});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore" id="apidoc.element.express-brute.MemoryStore">
        function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MemoryStore = function (options) {
	this.data = {};
	_.bindAll(this, &#x27;set&#x27;, &#x27;get&#x27;, &#x27;reset&#x27;);
	this.options = _.extend({}, MemoryStore.defaults, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      $ npm install express-brute

A Simple Example
----------------
``` js
var ExpressBrute = require(&#x27;express-brute&#x27;);

var store = new ExpressBrute.<span class="apidocCodeKeywordSpan">MemoryStore</span>(); // stores state locally, don&#x27;t use this
 in production
var bruteforce = new ExpressBrute(store);

app.post(&#x27;/auth&#x27;,
	bruteforce.prevent, // error 429 if we hit this route too often
	function (req, res, next) {
		res.send(&#x27;Success!&#x27;);
	}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.get" id="apidoc.element.express-brute.MemoryStore.prototype.get">
        function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore.prototype.get
        <span class="apidocSignatureSpan">(key, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MemoryStore.prototype.get = function (key, callback) {
	key = this.options.prefix+key;
	var data = this.data[key] &#x26;&#x26; this.data[key].value;
	if (data) {
		data = JSON.parse(data);
		data.lastRequest = new Date(data.lastRequest);
		data.firstRequest = new Date(data.firstRequest);
	}
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null, data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.reset" id="apidoc.element.express-brute.MemoryStore.prototype.reset">
        function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore.prototype.reset
        <span class="apidocSignatureSpan">(key, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MemoryStore.prototype.reset = function (key, callback) {
	key = this.options.prefix+key;
	
	if (this.data[key] &#x26;&#x26; this.data[key].timeout) {
		longTimeout.clearTimeout(this.data[key].timeout);
	}
	delete this.data[key];
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.set" id="apidoc.element.express-brute.MemoryStore.prototype.set">
        function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore.prototype.set
        <span class="apidocSignatureSpan">(key, value, lifetime, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MemoryStore.prototype.set = function (key, value, lifetime, callback) {
	key = this.options.prefix+key;
	lifetime = lifetime || 0;
	value = JSON.stringify(value);

	if (!this.data[key]) {
		this.data[key] = {};
	} else if (this.data[key].timeout) {
		longTimeout.clearTimeout(this.data[key].timeout);
	}
	this.data[key].value = value;

	if (lifetime) {
		this.data[key].timeout = longTimeout.setTimeout(_.bind(function () {
			delete this.data[key];
		}, this), 1000*lifetime);
	}
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute._getKey" id="apidoc.element.express-brute._getKey">
        function <span class="apidocSignatureSpan">express-brute.</span>_getKey
        <span class="apidocSignatureSpan">(arr)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_getKey = function (arr) {
	var key = &#x27;&#x27;;
	_(arr).each(function (part) {
		if (part) {
			key += crypto.createHash(&#x27;sha256&#x27;).update(part).digest(&#x27;base64&#x27;);
		}
	});
	return crypto.createHash(&#x27;sha256&#x27;).update(key).digest(&#x27;base64&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
		return typeof options.failCallback === &#x27;undefined&#x27; ? this.options.failCallback : options.failCallback;
	}, this);

	// create middleware
	return _.bind(function (req, res, next) {
		keyFunc(req, res, _.bind(function (key) {
			if(!options.ignoreIP) {
				key = ExpressBrute.<span class="apidocCodeKeywordSpan">_getKey</span>([req.ip, this.name, key]);
			} else {
				key = ExpressBrute._getKey([this.name, key]);
			}

			// attach a simpler &#x22;reset&#x22; function to req.brute.reset
			if (this.options.attachResetToRequest) {
				var reset = _.bind(function (callback) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.defaults.handleStoreError" id="apidoc.element.express-brute.defaults.handleStoreError">
        function <span class="apidocSignatureSpan">express-brute.</span>defaults.handleStoreError
        <span class="apidocSignatureSpan">(err)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">defaults.handleStoreError = function (err) {
		throw {
			message: err.message,
			parent: err.parent
		};
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.toString" id="apidoc.element.express-brute.toString">
        function <span class="apidocSignatureSpan">express-brute.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.AbstractClientStore" id="apidoc.module.express-brute.AbstractClientStore">module express-brute.AbstractClientStore</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.AbstractClientStore.AbstractClientStore" id="apidoc.element.express-brute.AbstractClientStore.AbstractClientStore">
        function <span class="apidocSignatureSpan">express-brute.</span>AbstractClientStore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">AbstractClientStore = function () {
	
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.AbstractClientStore.prototype" id="apidoc.module.express-brute.AbstractClientStore.prototype">module express-brute.AbstractClientStore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.AbstractClientStore.prototype.increment" id="apidoc.element.express-brute.AbstractClientStore.prototype.increment">
        function <span class="apidocSignatureSpan">express-brute.AbstractClientStore.prototype.</span>increment
        <span class="apidocSignatureSpan">(key, lifetime, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">increment = function (key, lifetime, callback) {
	var self = this;
	this.get(key, function (err, value) {
		if (err) {
			callback(err);
		} else {
			var count = value ? value.count+1 : 1;
			self.set(key, {count: count, lastRequest: new Date(), firstRequest: new Date()}, lifetime, function (err) {
				var prevValue = {
					count: value ? value.count : 0,
					lastRequest: value ? value.lastRequest : null,
					firstRequest: value ? value.firstRequest : null
				};
				typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(err, prevValue);
			});
		}
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.FailForbidden" id="apidoc.module.express-brute.FailForbidden">module express-brute.FailForbidden</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.FailForbidden.FailForbidden" id="apidoc.element.express-brute.FailForbidden.FailForbidden">
        function <span class="apidocSignatureSpan">express-brute.</span>FailForbidden
        <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">FailForbidden = function (req, res, next, nextValidRequestDate) {
	setRetryAfter(res, nextValidRequestDate);
	res.status(403);
	res.send({error: {text: &#x22;Too many requests in this time frame.&#x22;, nextValidRequestDate: nextValidRequestDate}});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.FailMark" id="apidoc.module.express-brute.FailMark">module express-brute.FailMark</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.FailMark.FailMark" id="apidoc.element.express-brute.FailMark.FailMark">
        function <span class="apidocSignatureSpan">express-brute.</span>FailMark
        <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">FailMark = function (req, res, next, nextValidRequestDate) {
	res.status(429);
	setRetryAfter(res, nextValidRequestDate);
	res.nextValidRequestDate = nextValidRequestDate;
	next();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.FailTooManyRequests" id="apidoc.module.express-brute.FailTooManyRequests">module express-brute.FailTooManyRequests</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.FailTooManyRequests.FailTooManyRequests" id="apidoc.element.express-brute.FailTooManyRequests.FailTooManyRequests">
        function <span class="apidocSignatureSpan">express-brute.</span>FailTooManyRequests
        <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">FailTooManyRequests = function (req, res, next, nextValidRequestDate) {
	setRetryAfter(res, nextValidRequestDate);
	res.status(429);
	res.send({error: {text: &#x22;Too many requests in this time frame.&#x22;, nextValidRequestDate: nextValidRequestDate}});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.MemoryStore" id="apidoc.module.express-brute.MemoryStore">module express-brute.MemoryStore</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.MemoryStore" id="apidoc.element.express-brute.MemoryStore.MemoryStore">
        function <span class="apidocSignatureSpan">express-brute.</span>MemoryStore
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MemoryStore = function (options) {
	this.data = {};
	_.bindAll(this, &#x27;set&#x27;, &#x27;get&#x27;, &#x27;reset&#x27;);
	this.options = _.extend({}, MemoryStore.defaults, options);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      $ npm install express-brute

A Simple Example
----------------
``` js
var ExpressBrute = require(&#x27;express-brute&#x27;);

var store = new ExpressBrute.<span class="apidocCodeKeywordSpan">MemoryStore</span>(); // stores state locally, don&#x27;t use this
 in production
var bruteforce = new ExpressBrute(store);

app.post(&#x27;/auth&#x27;,
	bruteforce.prevent, // error 429 if we hit this route too often
	function (req, res, next) {
		res.send(&#x27;Success!&#x27;);
	}
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.MemoryStore.prototype" id="apidoc.module.express-brute.MemoryStore.prototype">module express-brute.MemoryStore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.get" id="apidoc.element.express-brute.MemoryStore.prototype.get">
        function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>get
        <span class="apidocSignatureSpan">(key, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key, callback) {
	key = this.options.prefix+key;
	var data = this.data[key] &#x26;&#x26; this.data[key].value;
	if (data) {
		data = JSON.parse(data);
		data.lastRequest = new Date(data.lastRequest);
		data.firstRequest = new Date(data.firstRequest);
	}
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null, data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
				req.brute = {
					reset: reset
				};
			}


			// filter request
			this.store.<span class="apidocCodeKeywordSpan">get</span>(key, _.bind(function (err, value) {
				if (err) {
					this.options.handleStoreError({
						req: req,
						res: res,
						next: next,
						message: &#x22;Cannot get request count&#x22;,
						parent: err
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.reset" id="apidoc.element.express-brute.MemoryStore.prototype.reset">
        function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>reset
        <span class="apidocSignatureSpan">(key, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reset = function (key, callback) {
	key = this.options.prefix+key;
	
	if (this.data[key] &#x26;&#x26; this.data[key].timeout) {
		longTimeout.clearTimeout(this.data[key].timeout);
	}
	delete this.data[key];
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			// prevent too many attempts for the same username
			next(req.body.username);
		}
	}),
	function (req, res, next) {
		if (User.isValidLogin(req.body.username, req.body.password)) { // omitted for the sake of conciseness
		 	// reset the failure counter so next time they log in they get 5 tries again before the delays kick in
			req.brute.<span class="apidocCodeKeywordSpan">reset</span>(function () {
				res.redirect(&#x27;/&#x27;); // logged in, send them to the home page
			});
		} else {
			res.flash(&#x27;error&#x27;, &#x22;Invalid username or password&#x22;)
			res.redirect(&#x27;/login&#x27;); // bad username/password, send them back to the login page
		}
	}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.set" id="apidoc.element.express-brute.MemoryStore.prototype.set">
        function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>set
        <span class="apidocSignatureSpan">(key, value, lifetime, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (key, value, lifetime, callback) {
	key = this.options.prefix+key;
	lifetime = lifetime || 0;
	value = JSON.stringify(value);

	if (!this.data[key]) {
		this.data[key] = {};
	} else if (this.data[key].timeout) {
		longTimeout.clearTimeout(this.data[key].timeout);
	}
	this.data[key].value = value;

	if (lifetime) {
		this.data[key].timeout = longTimeout.setTimeout(_.bind(function () {
			delete this.data[key];
		}, this), 1000*lifetime);
	}
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	minWait: 25*60*60*1000, // 1 day 1 hour (should never reach this wait time)
	maxWait: 25*60*60*1000, // 1 day 1 hour (should never reach this wait time)
	lifetime: 24*60*60, // 1 day (seconds not milliseconds)
	failCallback: failCallback,
	handleStoreError: handleStoreError
});

app.<span class="apidocCodeKeywordSpan">set</span>(&#x27;trust proxy&#x27;, 1); // Don&#x27;t set to &#x22;true&#x22;, it&#x27;s
 not secure. Make sure it matches your environment
app.post(&#x27;/auth&#x27;,
	globalBruteforce.prevent,
	userBruteforce.getMiddleware({
		key: function(req, res, next) {
			// prevent too many attempts for the same username
			next(req.body.username);
		}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.MemoryStore.prototype.get" id="apidoc.module.express-brute.MemoryStore.prototype.get">module express-brute.MemoryStore.prototype.get</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.get.get" id="apidoc.element.express-brute.MemoryStore.prototype.get.get">
        function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>get
        <span class="apidocSignatureSpan">(key, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (key, callback) {
	key = this.options.prefix+key;
	var data = this.data[key] &#x26;&#x26; this.data[key].value;
	if (data) {
		data = JSON.parse(data);
		data.lastRequest = new Date(data.lastRequest);
		data.firstRequest = new Date(data.firstRequest);
	}
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null, data);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
				req.brute = {
					reset: reset
				};
			}


			// filter request
			this.store.<span class="apidocCodeKeywordSpan">get</span>(key, _.bind(function (err, value) {
				if (err) {
					this.options.handleStoreError({
						req: req,
						res: res,
						next: next,
						message: &#x22;Cannot get request count&#x22;,
						parent: err
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.MemoryStore.prototype.reset" id="apidoc.module.express-brute.MemoryStore.prototype.reset">module express-brute.MemoryStore.prototype.reset</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.reset.reset" id="apidoc.element.express-brute.MemoryStore.prototype.reset.reset">
        function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>reset
        <span class="apidocSignatureSpan">(key, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">reset = function (key, callback) {
	key = this.options.prefix+key;
	
	if (this.data[key] &#x26;&#x26; this.data[key].timeout) {
		longTimeout.clearTimeout(this.data[key].timeout);
	}
	delete this.data[key];
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			// prevent too many attempts for the same username
			next(req.body.username);
		}
	}),
	function (req, res, next) {
		if (User.isValidLogin(req.body.username, req.body.password)) { // omitted for the sake of conciseness
		 	// reset the failure counter so next time they log in they get 5 tries again before the delays kick in
			req.brute.<span class="apidocCodeKeywordSpan">reset</span>(function () {
				res.redirect(&#x27;/&#x27;); // logged in, send them to the home page
			});
		} else {
			res.flash(&#x27;error&#x27;, &#x22;Invalid username or password&#x22;)
			res.redirect(&#x27;/login&#x27;); // bad username/password, send them back to the login page
		}
	}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.MemoryStore.prototype.set" id="apidoc.module.express-brute.MemoryStore.prototype.set">module express-brute.MemoryStore.prototype.set</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.MemoryStore.prototype.set.set" id="apidoc.element.express-brute.MemoryStore.prototype.set.set">
        function <span class="apidocSignatureSpan">express-brute.MemoryStore.prototype.</span>set
        <span class="apidocSignatureSpan">(key, value, lifetime, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (key, value, lifetime, callback) {
	key = this.options.prefix+key;
	lifetime = lifetime || 0;
	value = JSON.stringify(value);

	if (!this.data[key]) {
		this.data[key] = {};
	} else if (this.data[key].timeout) {
		longTimeout.clearTimeout(this.data[key].timeout);
	}
	this.data[key].value = value;

	if (lifetime) {
		this.data[key].timeout = longTimeout.setTimeout(_.bind(function () {
			delete this.data[key];
		}, this), 1000*lifetime);
	}
	typeof callback == &#x27;function&#x27; &#x26;&#x26; callback(null);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
	minWait: 25*60*60*1000, // 1 day 1 hour (should never reach this wait time)
	maxWait: 25*60*60*1000, // 1 day 1 hour (should never reach this wait time)
	lifetime: 24*60*60, // 1 day (seconds not milliseconds)
	failCallback: failCallback,
	handleStoreError: handleStoreError
});

app.<span class="apidocCodeKeywordSpan">set</span>(&#x27;trust proxy&#x27;, 1); // Don&#x27;t set to &#x22;true&#x22;, it&#x27;s
 not secure. Make sure it matches your environment
app.post(&#x27;/auth&#x27;,
	globalBruteforce.prevent,
	userBruteforce.getMiddleware({
		key: function(req, res, next) {
			// prevent too many attempts for the same username
			next(req.body.username);
		}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute._getKey" id="apidoc.module.express-brute._getKey">module express-brute._getKey</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute._getKey._getKey" id="apidoc.element.express-brute._getKey._getKey">
        function <span class="apidocSignatureSpan">express-brute.</span>_getKey
        <span class="apidocSignatureSpan">(arr)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_getKey = function (arr) {
	var key = &#x27;&#x27;;
	_(arr).each(function (part) {
		if (part) {
			key += crypto.createHash(&#x27;sha256&#x27;).update(part).digest(&#x27;base64&#x27;);
		}
	});
	return crypto.createHash(&#x27;sha256&#x27;).update(key).digest(&#x27;base64&#x27;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
		return typeof options.failCallback === &#x27;undefined&#x27; ? this.options.failCallback : options.failCallback;
	}, this);

	// create middleware
	return _.bind(function (req, res, next) {
		keyFunc(req, res, _.bind(function (key) {
			if(!options.ignoreIP) {
				key = ExpressBrute.<span class="apidocCodeKeywordSpan">_getKey</span>([req.ip, this.name, key]);
			} else {
				key = ExpressBrute._getKey([this.name, key]);
			}

			// attach a simpler &#x22;reset&#x22; function to req.brute.reset
			if (this.options.attachResetToRequest) {
				var reset = _.bind(function (callback) {
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.defaults" id="apidoc.module.express-brute.defaults">module express-brute.defaults</a></h1>






    <h2>
        <a href="#apidoc.element.express-brute.defaults.failCallback" id="apidoc.element.express-brute.defaults.failCallback">
        function <span class="apidocSignatureSpan">express-brute.defaults.</span>failCallback
        <span class="apidocSignatureSpan">(req, res, next, nextValidRequestDate)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">failCallback = function (req, res, next, nextValidRequestDate) {
	setRetryAfter(res, nextValidRequestDate);
	res.status(429);
	res.send({error: {text: &#x22;Too many requests in this time frame.&#x22;, nextValidRequestDate: nextValidRequestDate}});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.express-brute.defaults.handleStoreError" id="apidoc.element.express-brute.defaults.handleStoreError">
        function <span class="apidocSignatureSpan">express-brute.defaults.</span>handleStoreError
        <span class="apidocSignatureSpan">(err)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handleStoreError = function (err) {
		throw {
			message: err.message,
			parent: err.parent
		};
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
				};
			}


			// filter request
			this.store.get(key, _.bind(function (err, value) {
				if (err) {
					this.options.<span class="apidocCodeKeywordSpan">handleStoreError</span>({
						req: req,
						res: res,
						next: next,
						message: &#x22;Cannot get request count&#x22;,
						parent: err
					});
					return;
...</pre></li>
    </ul>










</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.defaults.handleStoreError" id="apidoc.module.express-brute.defaults.handleStoreError">module express-brute.defaults.handleStoreError</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.defaults.handleStoreError.handleStoreError" id="apidoc.element.express-brute.defaults.handleStoreError.handleStoreError">
        function <span class="apidocSignatureSpan">express-brute.defaults.</span>handleStoreError
        <span class="apidocSignatureSpan">(err)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">handleStoreError = function (err) {
		throw {
			message: err.message,
			parent: err.parent
		};
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
				};
			}


			// filter request
			this.store.get(key, _.bind(function (err, value) {
				if (err) {
					this.options.<span class="apidocCodeKeywordSpan">handleStoreError</span>({
						req: req,
						res: res,
						next: next,
						message: &#x22;Cannot get request count&#x22;,
						parent: err
					});
					return;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.express-brute.toString" id="apidoc.module.express-brute.toString">module express-brute.toString</a></h1>


    <h2>
        <a href="#apidoc.element.express-brute.toString.toString" id="apidoc.element.express-brute.toString.toString">
        function <span class="apidocSignatureSpan">express-brute.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
